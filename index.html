<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant for Word</title>
    
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: #5d5d5d;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .input-group {
            margin: 12px 0;
        }
        
        textarea, input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s ease;
            background: #f8f9fa;
        }
        
        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }
        
        textarea {
            height: 80px;
            resize: vertical;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result {
            margin-top: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            display: none;
            font-size: 14px;
        }
        
        .result.error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            font-size: 12px;
            color: rgba(255,255,255,0.8);
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc3545;
        }
        
        .status-dot.connected {
            background: #28a745;
        }
        
        .settings-section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Assistant</h1>
            <p>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DeepSeek AI ‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è</p>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API -->
        <div class="card">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ DeepSeek API</h3>
            <div class="input-group">
                <input type="password" id="apiKey" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à DeepSeek API –∫–ª—é—á" />
            </div>
            <button class="btn btn-success" onclick="saveApiKey()">
                <span>üíæ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á
            </button>
            <div class="api-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="apiStatusText">API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span>
            </div>
            
            <div class="settings-section">
                <p><strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á:</strong></p>
                <ol style="font-size: 11px; margin-left: 15px; margin-top: 8px;">
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ <a href="https://platform.deepseek.com" target="_blank" style="color: #667eea;">platform.deepseek.com</a></li>
                    <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</li>
                    <li>–í —Ä–∞–∑–¥–µ–ª–µ API Keys —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á</li>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤—ã—à–µ</li>
                </ol>
            </div>
        </div>

        <div class="card">
            <h3>üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ</h3>
            <button class="btn" onclick="checkGrammar()">
                <span>üîç</span> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞–º–º–∞—Ç–∏–∫—É
            </button>
            <button class="btn" onclick="improveText()">
                <span>‚ú®</span> –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç
            </button>
            <button class="btn" onclick="simplifyText()">
                <span>üìñ</span> –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç
            </button>
        </div>

        <div class="card">
            <h3>‚úçÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞</h3>
            <div class="input-group">
                <input type="text" id="promptInput" placeholder="–û —á–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç?" />
            </div>
            <button class="btn" onclick="generateText()">
                <span>üöÄ</span> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
            </button>
        </div>

        <div class="card">
            <h3>üîÑ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h3>
            <div class="input-group">
                <select id="transformType">
                    <option value="formal">üìä –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º</option>
                    <option value="casual">üòä –°–¥–µ–ª–∞—Ç—å –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º</option>
                    <option value="shorten">üìâ –°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç</option>
                    <option value="expand">üìà –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ–∫—Å—Ç</option>
                </select>
            </div>
            <button class="btn" onclick="transformText()">
                <span>üîÑ</span> –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å
            </button>
        </div>

        <div class="card">
            <h3>üéØ –ö–∞—Å—Ç–æ–º–Ω—ã–π –∑–∞–ø—Ä–æ—Å</h3>
            <div class="input-group">
                <textarea id="customPrompt" placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å —Ç–µ–∫—Å—Ç–æ–º..."></textarea>
            </div>
            <button class="btn" onclick="customAction()">
                <span>‚ö°</span> –í—ã–ø–æ–ª–Ω–∏—Ç—å
            </button>
        </div>

        <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API -->
        <div class="card">
            <h3>üß™ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
            <button class="btn btn-secondary" onclick="testApiConnection()">
                <span>üîó</span> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ DeepSeek
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>DeepSeek AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞—à –∑–∞–ø—Ä–æ—Å...</p>
        </div>

        <div class="result" id="result"></div>
        
        <div class="status" id="status">
            –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ ‚Ä¢ –í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DeepSeek API
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';
        const DEEPSEEK_MODEL = 'deepseek-chat'; // –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        Office.onReady((info) => {
            if (info.host === Office.HostType.Word) {
                document.getElementById('status').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Word ‚Ä¢ –í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã';
                loadApiKey();
                console.log('AI Assistant with DeepSeek loaded successfully');
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –∫–ª—é—á–æ–º
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á');
                return;
            }
            
            localStorage.setItem('deepseek_api_key', apiKey);
            updateApiStatus(true);
            showResult('API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', false);
        }

        function loadApiKey() {
            const savedKey = localStorage.getItem('deepseek_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
                updateApiStatus(true);
            } else {
                updateApiStatus(false);
            }
        }

        function updateApiStatus(connected) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('apiStatusText');
            
            if (connected) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω';
            } else {
                statusDot.className = 'status-dot';
                statusText.textContent = 'API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω';
            }
        }

        function getApiKey() {
            return localStorage.getItem('deepseek_api_key');
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–∑–æ–≤–∞ DeepSeek API
        async function callDeepSeekAI(prompt, systemMessage = "–¢—ã –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º.") {
            const apiKey = getApiKey();
            if (!apiKey) {
                throw new Error('API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à DeepSeek API –∫–ª—é—á –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.');
            }

            try {
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: DEEPSEEK_MODEL,
                        messages: [
                            {
                                role: "system",
                                content: systemMessage
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7,
                        stream: false
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`API –æ—à–∏–±–∫–∞: ${response.status} - ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                return data.choices[0].message.content.trim();
            } catch (error) {
                console.error('DeepSeek API error:', error);
                throw error;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º –≤ Word
        async function getSelectedText() {
            try {
                return await Word.run(async (context) => {
                    const selection = context.document.getSelection();
                    selection.load('text');
                    await context.sync();
                    return selection.text.trim();
                });
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞: ' + error.message);
                return null;
            }
        }

        async function insertText(text) {
            try {
                await Word.run(async (context) => {
                    const selection = context.document.getSelection();
                    selection.insertText(text, Word.InsertLocation.replace);
                    await context.sync();
                });
                return true;
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Ç–µ–∫—Å—Ç–∞: ' + error.message);
                return false;
            }
        }

        // –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
        const PROMPTS = {
            grammar: (text) => `–ü—Ä–æ–≤–µ—Ä—å –≥—Ä–∞–º–º–∞—Ç–∏–∫—É, –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—é –∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:\n\n${text}`,
            
            improve: (text) => `–£–ª—É—á—à–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ: —Å–¥–µ–ª–∞–π –µ–≥–æ –±–æ–ª–µ–µ –≥—Ä–∞–º–æ—Ç–Ω—ã–º, —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏ —á–∏—Ç–∞–µ–º—ã–º. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —É–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${text}`,
            
            simplify: (text) => `–£–ø—Ä–æ—Å—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —Å–¥–µ–ª–∞–π –µ–≥–æ –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è —à–∏—Ä–æ–∫–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏. –°–æ—Ö—Ä–∞–Ω–∏ –æ—Å–Ω–æ–≤–Ω—É—é –º—ã—Å–ª—å, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${text}`,
            
            formal: (text) => `–ü—Ä–µ–æ–±—Ä–∞–∑—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –≤ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ-–¥–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${text}`,
            
            casual: (text) => `–°–¥–µ–ª–∞–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º –∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${text}`,
            
            shorten: (text) => `–°–æ–∫—Ä–∞—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –æ—Å–Ω–æ–≤–Ω—É—é –º—ã—Å–ª—å –∏ –∫–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${text}`,
            
            expand: (text) => `–†–∞—Å—à–∏—Ä—å –∏ –¥–æ–ø–æ–ª–Ω–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –¥–æ–±–∞–≤–∏–≤ –¥–µ—Ç–∞–ª–µ–π –∏ —Ä–∞—Å–∫—Ä—ã–≤ —Ç–µ–º—É –±–æ–ª–µ–µ –ø–æ–ª–Ω–æ. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${text}`,
            
            generate: (prompt) => `–ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–ø–∏—Å–∞–Ω–∏—é: "${prompt}". –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥—Ä–∞–º–æ—Ç–Ω—ã–º, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ–º–µ.`,
            
            custom: (text, customPrompt) => `${customPrompt}\n\n–¢–µ–∫—Å—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã: ${text}`
        };

        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        async function processWithAI(action, text, customPrompt = '') {
            showLoading(true);
            
            try {
                let prompt;
                if (action === 'generate') {
                    prompt = PROMPTS.generate(text);
                } else if (action === 'custom') {
                    prompt = PROMPTS.custom(text, customPrompt);
                } else {
                    prompt = PROMPTS[action](text);
                }

                const result = await callDeepSeekAI(prompt, "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –ø–∏—Å–∞—Ç–µ–ª—å, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.");
                
                const success = await insertText(result);
                showLoading(false);
                
                if (success) {
                    const messages = {
                        grammar: '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å –ø–æ–º–æ—â—å—é DeepSeek AI!',
                        improve: '–¢–µ–∫—Å—Ç —É–ª—É—á—à–µ–Ω —Å –ø–æ–º–æ—â—å—é DeepSeek AI!',
                        simplify: '–¢–µ–∫—Å—Ç —É–ø—Ä–æ—â–µ–Ω —Å –ø–æ–º–æ—â—å—é DeepSeek AI!',
                        formal: '–¢–µ–∫—Å—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å!',
                        casual: '–¢–µ–∫—Å—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å!',
                        shorten: '–¢–µ–∫—Å—Ç —Å–æ–∫—Ä–∞—â–µ–Ω!',
                        expand: '–¢–µ–∫—Å—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω!',
                        generate: '–¢–µ–∫—Å—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–º–æ—â—å—é DeepSeek AI!',
                        custom: '–ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –ø–æ–º–æ—â—å—é DeepSeek AI!'
                    };
                    
                    showResult(messages[action] || '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', false);
                }
            } catch (error) {
                showLoading(false);
                showError(`–û—à–∏–±–∫–∞ DeepSeek API: ${error.message}`);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        async function checkGrammar() {
            const text = await getSelectedText();
            if (!text) return showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
            await processWithAI('grammar', text);
        }

        async function improveText() {
            const text = await getSelectedText();
            if (!text) return showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è');
            await processWithAI('improve', text);
        }

        async function simplifyText() {
            const text = await getSelectedText();
            if (!text) return showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è');
            await processWithAI('simplify', text);
        }

        async function generateText() {
            const prompt = document.getElementById('promptInput').value;
            if (!prompt) return showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞');
            
            await processWithAI('generate', prompt);
            document.getElementById('promptInput').value = '';
        }

        async function transformText() {
            const text = await getSelectedText();
            if (!text) return showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è');
            
            const transformType = document.getElementById('transformType').value;
            await processWithAI(transformType, text);
        }

        async function customAction() {
            const text = await getSelectedText();
            const prompt = document.getElementById('customPrompt').value;
            if (!prompt) return showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å');
            
            await processWithAI('custom', text || '', prompt);
            document.getElementById('customPrompt').value = '';
        }

        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function testApiConnection() {
            const apiKey = getApiKey();
            if (!apiKey) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ API –∫–ª—é—á');
                return;
            }

            showLoading(true);
            try {
                const testPrompt = "–û—Ç–≤–µ—Ç—å –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º: '—Ä–∞–±–æ—Ç–∞–µ—Ç'";
                const response = await callDeepSeekAI(testPrompt, "–¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º.");
                
                showLoading(false);
                if (response && response.toLowerCase().includes('—Ä–∞–±–æ—Ç–∞–µ—Ç')) {
                    showResult('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ DeepSeek API —É—Å–ø–µ—à–Ω–æ!', false);
                    updateApiStatus(true);
                } else {
                    showError('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API');
                }
            } catch (error) {
                showLoading(false);
                showError(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                updateApiStatus(false);
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = isError ? 'result error' : 'result';
            resultDiv.style.display = 'block';
            
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            showResult(message, true);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                btn.addEventListener('mouseenter', function() {
                    if (!this.disabled) {
                        this.style.transform = 'translateY(-2px)';
                    }
                });
                
                btn.addEventListener('mouseleave', function() {
                    if (!this.disabled) {
                        this.style.transform = 'translateY(0)';
                    }
                });
            });
        });
    </script>
</body>
</html>